---
title: "Example"
author: "YannisMarkonis"
date: "May 15, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
```

```{r libraries}
require(ggplot2)
```

## Introduction

This is a presentation of the scalegram methodology, applied for the validation of satellite precipitation product. Here, we use the [GPM IMERGHH data product](https://disc.gsfc.nasa.gov/datasets/GPM_3IMERGHH_05/summary) and the dense precipitation network of National Observatory of Athens for Attiki (Greece) region.

## Data

_Satellite data (gpm) info:_

* Dataset: GPM IMERG Final Precipitation L3 Half Hourly 0.1 degree x 0.1 degree V05
* Date Range: 2017-11-30 to 2017-12-31
* Spatial Region 23.269, 37.786, 23.906, 38.467
* Variables: precipitationCal
* Format: netCDF 4

The data were cropped to [2017-12-01, 2017-12-31] period. Then all grid cells with no gauge closer than 0.5 deg were removed.

Right now working with the 1d product downloaded from knmi, which does not correspond to the 30-min. Have to check code and version.

_Instrumental data (noa) info:_

* Dataset: NOA automatic precipitation network
* 10 minute precipitation 
* Date Range: 2017-12-01, 2017-12-31
* Spatial Region 23.269, 37.786, 23.906, 38.467
* Variables: rainfall
* Format: txt

Stations above 400 meters were removed.

```{r plot stations/grid cells}
load("./data/dataset.rdata") 


noa_stations <- match_noa_gpm(noa_stations, gpm_d_cells)

noa_locations <- noa_stations[, c(1, 3, 4, 6)]
noa_locations$dataset <- factor("noa")
gpm_locations <- gpm_d_cells[id %in% noa_stations$nearest_cell]
gpm_locations$nearest_cell <- gpm_locations$id
gpm_locations$dataset <- factor("gpm")
all_locations <- rbind(noa_locations, gpm_locations)
ggplot(data = all_locations, aes(lon, lat, size = dataset, col = nearest_cell)) +
  geom_point() 

```
